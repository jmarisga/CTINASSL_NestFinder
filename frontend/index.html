<!DOCTYPE html>
<html lang="en">

  <head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">

    <title>Nest Finder - Real Estate Platform</title>

    <!-- Bootstrap core CSS -->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">


    <!-- Additional CSS Files -->
    <link rel="stylesheet" href="assets/css/fontawesome.css">
    <link rel="stylesheet" href="assets/css/templatemo-villa-agency.css">
    <link rel="stylesheet" href="assets/css/owl.css">
    <link rel="stylesheet" href="assets/css/animate.css">
    <link rel="stylesheet"href="https://unpkg.com/swiper@7/swiper-bundle.min.css"/>
  </head>

<body>

  <!-- ***** Preloader Start ***** -->
  <div id="js-preloader" class="js-preloader">
    <div class="preloader-inner">
      <span class="dot"></span>
      <div class="dots">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </div>
  </div>
  <!-- ***** Preloader End ***** -->

  <div class="sub-header"
    <div class="container">
      <div class="row">
        <div class="col-lg-8 col-md-8">
          <ul class="info">
            <li><i class="fa fa-envelope"></i> info@nestfinder.com</li>
            <li><i class="fa fa-map"></i> S4F, New City Hall Bldg, Brgy. Poblacion, San Pedro, Laguna </li>
          </ul>
        </div>
        <div class="col-lg-4 col-md-4">
          <ul class="social-links">
            <li><a href="#"><i class="fab fa-facebook"></i></a></li>
            <li><a href="https://x.com/minthu" target="_blank"><i class="fab fa-twitter"></i></a></li>
            <li><a href="#"><i class="fab fa-linkedin"></i></a></li>
            <li><a href="#"><i class="fab fa-instagram"></i></a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <!-- ***** Header Area Start ***** -->
  <header class="header-area header-sticky">
    <div class="container">
        <div class="row">
            <div class="col-12">
                <nav class="main-nav">
                    <!-- ***** Logo Start ***** -->
                    <a href="index.html" class="logo">
                        <h1>NEST<span style="margin-left: 8px;">FINDER</span></h1>
                    </a>
                    <!-- ***** Logo End ***** -->
                    <!-- ***** Menu Start ***** -->
                    <ul class="nav">
                      <li><a href="index.html" class="active">Home</a></li>
                      <li><a href="properties.html">Properties</a></li>
                      <li><a href="property-details.html">Property Details</a></li>
                      <li id="nav-login-item"><a href="#" id="nav-login-link">Login</a></li>
                      <li id="nav-register-item"><a href="#" id="nav-register-link">Register</a></li>
                      <li id="nav-logout-item" style="display:none;"><a href="#" id="nav-logout-link">Logout</a></li>
                      <li><a href="#" id="nav-schedule-link"><i class="fa fa-calendar"></i> Schedule a visit</a></li>
                  </ul>   
                    <a class='menu-trigger'>
                        <span>Menu</span>
                    </a>
                    <!-- ***** Menu End ***** -->
                </nav>
            </div>
        </div>
    </div>
  </header>
  <!-- ***** Header Area End ***** -->

  <!-- Auth & Schedule Modals -->
  <div class="modal fade" id="authModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="authModalTitle">Login</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="auth-form">
            <div class="mb-3" id="auth-name-group" style="display:none;">
              <label for="auth-name" class="form-label">Full Name</label>
              <input type="text" class="form-control" id="auth-name" placeholder="Your full name">
            </div>
            <div class="mb-3">
              <label for="auth-email" class="form-label">Email address</label>
              <input type="email" class="form-control" id="auth-email" placeholder="you@example.com" required>
            </div>
            <div class="mb-3">
              <label for="auth-password" class="form-label">Password</label>
              <input type="password" class="form-control" id="auth-password" placeholder="********" minlength="8" required>
            </div>
            <div class="alert alert-danger py-2 px-3" id="auth-error" style="display:none;font-size:0.85rem;"></div>
            <button type="submit" class="btn btn-primary w-100" id="auth-submit-btn">Login</button>
            <p class="mt-3 mb-0 text-center" id="auth-toggle-text" style="font-size:0.9rem;">
              Don't have an account? <a href="#" id="auth-toggle-link">Register</a>
            </p>
          </form>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="authFeedbackModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="auth-feedback-title">Notice</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body" id="auth-feedback-body">Success</div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" data-bs-dismiss="modal">OK</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="logoutConfirmModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Confirm logout</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">Are you sure you want to log out?</div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" id="logout-confirm-no">Cancel</button>
          <button type="button" class="btn btn-primary" id="logout-confirm-yes">Logout</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="scheduleModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Schedule a Visit</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="schedule-form">
            <div class="mb-3">
              <label for="schedule-property-name" class="form-label">Selected Property</label>
              <input type="text" class="form-control" id="schedule-property-name" readonly>
            </div>
            <div class="mb-3">
              <label for="schedule-date" class="form-label">Preferred Date & Time</label>
              <input type="datetime-local" class="form-control" id="schedule-date" required>
            </div>
            <div class="mb-3">
              <label for="schedule-notes" class="form-label">Notes (optional)</label>
              <textarea class="form-control" id="schedule-notes" rows="3" placeholder="Anything specific you would like to see or know?"></textarea>
            </div>
            <div class="alert alert-danger py-2 px-3" id="schedule-error" style="display:none;font-size:0.85rem;"></div>
            <div class="alert alert-success py-2 px-3" id="schedule-success" style="display:none;font-size:0.85rem;"></div>
            <button type="submit" class="btn btn-primary w-100">Confirm Visit</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <div class="main-banner">
    <div class="owl-carousel owl-banner">
      <div class="item item-1">
        <div class="header-text">
          <span class="category">Biñan, <em>Laguna</em></span>
          <h2>Hurry!<br>Get the Best Nest for you</h2>
        </div>
      </div>
      <div class="item item-2">
        <div class="header-text">
          <span class="category">San Pablo, <em>Laguna</em></span>
          <h2>Be Quick!<br>Get the best nest in town</h2>
        </div>
      </div>
      <div class="item item-3">
        <div class="header-text">
          <span class="category">Pila, <em>Laguna</em></span>
          <h2>Act Now!<br>Get the highest level house in town</h2>
        </div>
      </div>
    </div>
  </div>

  <div class="featured section">
    <div class="container">
      <div class="row">
        <div class="col-lg-4">
          <div class="left-image">
            <img src="assets/images/featured.jpg" alt="">
            <a href="property-details.html"><img src="assets/images/featured-icon.png" alt="" style="max-width: 60px; padding: 0px;"></a>
          </div>
        </div>
        <div class="col-lg-5">
          <div class="section-heading">
            <h6>| Featured</h6>
            <h2>Best Apartment &amp; Sea view</h2>
          </div>
          <div class="accordion" id="accordionExample">
            <div class="accordion-item">
              <h2 class="accordion-header" id="headingOne">
                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                  Best useful links ?
                </button>
              </h2>
              <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne" data-bs-parent="#accordionExample">
                <div class="accordion-body">
                Discover helpful resources to guide your property search in Laguna City. Whether you're exploring apartments, villa houses, or penthouses, these links connect you to trusted tools, updated listings, and tips for choosing the right home. Use them to stay informed and make smarter decisions during your search.</div>
              </div>
            </div>
            <div class="accordion-item">
              <h2 class="accordion-header" id="headingTwo">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                  How does this work ?
                </button>
              </h2>
              <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo" data-bs-parent="#accordionExample">
                <div class="accordion-body">
                Nest Finder makes property hunting simple. Just browse through the listings, use filters to narrow down your options, and check each property’s details. If something interests you, you can schedule a visit or contact the owner/agent directly. Everything is designed to help you find the right place faster and easier.
                </div>
              </div>
            </div>
            <div class="accordion-item">
              <h2 class="accordion-header" id="headingThree">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                  Why is Villa Agency the best ?
                </button>
              </h2>
              <div id="collapseThree" class="accordion-collapse collapse" aria-labelledby="headingThree" data-bs-parent="#accordionExample">
                <div class="accordion-body">
                  Nest Finder focuses on properties specifically in Laguna City, making your search more accurate and relevant. We offer organized categories, clear property details, and easy scheduling for site visits. Our goal is to give users a smooth, hassle-free experience—helping you find the perfect home.
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-lg-3">
          <div class="info-table">
            <ul>
              <li>
                <img src="assets/images/info-icon-01.png" alt="" style="max-width: 52px;">
                <h4>250 m2<br><span>Total Flat Space</span></h4>
              </li>
              <li>
                <img src="assets/images/info-icon-02.png" alt="" style="max-width: 52px;">
                <h4>Contact Agent<br><span>Contract Ready</span></h4>
              </li>
              <li>
                <img src="assets/images/info-icon-03.png" alt="" style="max-width: 52px;">
                <h4>Bank<br><span>Payment Process</span></h4>
              </li>
              <li>
                <img src="assets/images/info-icon-04.png" alt="" style="max-width: 52px;">
                <h4>Safety<br><span>24/7 Under Control</span></h4>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="video section">
    <div class="container">
      <div class="row">
        <div class="col-lg-4 offset-lg-4">
          <div class="section-heading text-center">
            <h6>| Video View</h6>
            <h2>Get Closer View & Different Feeling</h2>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="video-content">
    <div class="container">
      <div class="row">
        <div class="col-lg-10 offset-lg-1">
          <div class="video-frame">
            <img src="assets/images/video-frame.jpg" alt="">
            <a href="https://youtube.com" target="_blank"><i class="fa fa-play"></i></a>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="section best-deal">
    <div class="container">
      <div class="row">
        <div class="col-lg-4">
          <div class="section-heading">
            <h6>| Best Deal</h6>
            <h2>Find Your Best Deal Right Now!</h2>
          </div>
        </div>
        <div class="col-lg-12">
          <div class="tabs-content">
            <div class="row">
              <div class="nav-wrapper ">
                <ul class="nav nav-tabs" role="tablist">
                  <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="apartment-tab" data-bs-toggle="tab" data-bs-target="#apartment" type="button" role="tab" aria-controls="apartment" aria-selected="true">Apartment</button>
                  </li>
                  <li class="nav-item" role="presentation">
                    <button class="nav-link" id="house-tab" data-bs-toggle="tab" data-bs-target="#house" type="button" role="tab" aria-controls="villa" aria-selected="false">House</button>
                  </li>
                  <li class="nav-item" role="presentation">
                    <button class="nav-link" id="villahouse-tab" data-bs-toggle="tab" data-bs-target="#villahouse" type="button" role="tab" aria-controls="villahouse" aria-selected="false">Villa House</button>
                  </li>
                </ul>
              </div>              
              <div class="tab-content" id="myTabContent">
                <div class="tab-pane fade show active" id="apartment" role="tabpanel" aria-labelledby="apartment-tab">
                  <div class="row">
                    <div class="col-lg-3">
                      <div class="info-table">
                        <ul id="apartment-info">
                          <li>Total Flat Space <span>185 m2</span></li>
                          <li>Floor number <span>26th</span></li>
                          <li>Number of rooms <span>4</span></li>
                          <li>Parking Available <span>Yes</span></li>
                          <li>Payment Process <span>Bank</span></li>
                        </ul>
                      </div>
                    </div>
                    <div class="col-lg-6">
                      <img id="apartment-image" src="assets/images/deal-01.jpg" alt="">
                    </div>
                    <div class="col-lg-3">
                      <h4>Extra Info About Property</h4>
                      <p id="apartment-description">Lorem ipsum dolor sit amet, consectetur adipiscing elit, do eiusmod tempor pack incididunt ut labore et dolore magna aliqua quised ipsum suspendisse. 
                      <br><br>When you need free CSS templates, you can simply type TemplateMo in any search engine website. In addition, you can type TemplateMo Portfolio, TemplateMo One Page Layouts, etc.</p>
                      <div class="icon-button">
                        <a id="apartment-visit-link" href="property-details.html"><i class="fa fa-calendar"></i> Schedule a visit</a>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="tab-pane fade" id="house" role="tabpanel" aria-labelledby="house-tab">
                  <div class="row">
                    <div class="col-lg-3">
                      <div class="info-table">
                        <ul id="house-info">
                          <li>Total Flat Space <span>250 m2</span></li>
                          <li>Floor number <span>26th</span></li>
                          <li>Number of rooms <span>5</span></li>
                          <li>Parking Available <span>Yes</span></li>
                          <li>Payment Process <span>Bank</span></li>
                        </ul>
                      </div>
                    </div>
                    <div class="col-lg-6">
                      <img id="house-image" src="assets/images/deal-02.jpg" alt="">
                    </div>
                    <div class="col-lg-3">
                      <h4>Detail Info About House</h4>
                      <p id="house-description">Lorem ipsum dolor sit amet, consectetur adipiscing elit, do eiusmod tempor pack incididunt ut labore et dolore magna aliqua quised ipsum suspendisse. <br><br>Swag fanny pack lyft blog twee. JOMO ethical copper mug, succulents typewriter shaman DIY kitsch twee taiyaki fixie hella venmo after messenger poutine next level humblebrag swag franzen.</p>
                      <div class="icon-button">
                        <a id="house-visit-link" href="property-details.html"><i class="fa fa-calendar"></i> Schedule a visit</a>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="tab-pane fade" id="villahouse" role="tabpanel" aria-labelledby="villahouse-tab">
                  <div class="row">
                    <div class="col-lg-3">
                      <div class="info-table">
                        <ul id="villahouse-info">
                          <li>Total Flat Space <span>320 m2</span></li>
                          <li>Floor number <span>34th</span></li>
                          <li>Number of rooms <span>6</span></li>
                          <li>Parking Available <span>Yes</span></li>
                          <li>Payment Process <span>Bank</span></li>
                        </ul>
                      </div>
                    </div>
                    <div class="col-lg-6">
                      <img id="villahouse-image" src="assets/images/deal-03.jpg" alt="">
                    </div>
                    <div class="col-lg-3">
                      <h4>Extra Info About Villa House</h4>
                      <p id="villahouse-description">Lorem ipsum dolor sit amet, consectetur adipiscing elit, do eiusmod tempor pack incididunt ut labore et dolore magna aliqua quised ipsum suspendisse. <br><br>Swag fanny pack lyft blog twee. JOMO ethical copper mug, succulents typewriter shaman DIY kitsch twee taiyaki fixie hella venmo after messenger poutine next level humblebrag swag franzen.</p>
                      <div class="icon-button">
                        <a id="villahouse-visit-link" href="property-details.html"><i class="fa fa-calendar"></i> Schedule a visit</a>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="properties section" id="properties-section">
    <div class="container">
      <div class="row">
        <div class="col-lg-4 offset-lg-4">
          <div class="section-heading text-center">
            <h6>| Properties</h6>
            <h2>We Provide The Best Property You Like</h2>
          </div>
        </div>
      </div>
      <div class="row">
        <!-- Properties will be dynamically loaded from property-data.js -->
      </div>
    </div>
  </div>

  <div class="contact section">
    <div class="container">
      <div class="row">
        <div class="col-lg-4 offset-lg-4">
          <div class="section-heading text-center">
            <h6>| Contact Us</h6>
            <h2>Get In Touch With Our Agents</h2>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="contact-content">
    <div class="container">
      <div class="row">
        <div class="col-lg-7">
          <div id="map">
           <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d61841.7898782027!2d120.98826162167964!3d14.362937499999997!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x3397d0b9bbf1ca31%3A0x16468ca612a8847f!2sSan%20Pedro%20City%20Hall!5e0!3m2!1sen!2sph!4v1764858998647!5m2!1sen!2sph" width="600" height="450" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
          </div>
          <div class="row">
            <div class="col-lg-6">
              <div class="item phone">
                <img src="assets/images/phone-icon.png" alt="" style="max-width: 52px;">
                <h6>010-020-0340<br><span>Phone Number</span></h6>
              </div>
            </div>
            
            <div class="col-lg-6">
              <div class="item email">
                <img src="assets/images/email-icon.png" alt="" style="max-width: 52px;">
                <h6>info@nestfinder.com<br><span>Business Email</span></h6>
              </div>
            </div>
          </div>
        </div>
        <div class="col-lg-5">
          <form id="contact-form" action="" method="post">
            <div class="row">
              <div class="col-lg-12">
                <fieldset>
                  <label for="name">Full Name</label>
                  <input type="name" name="name" id="name" placeholder="Your Name..." autocomplete="on" required>
                </fieldset>
              </div>
              <div class="col-lg-12">
                <fieldset>
                  <label for="email">Email Address</label>
                  <input type="text" name="email" id="email" pattern="[^ @]*@[^ @]*" placeholder="Your E-mail..." required="">
                </fieldset>
              </div>
              <div class="col-lg-12">
                <fieldset>
                  <label for="subject">Subject</label>
                  <input type="subject" name="subject" id="subject" placeholder="Subject..." autocomplete="on" >
                </fieldset>
              </div>
              <div class="col-lg-12">
                <fieldset>
                  <label for="message">Message</label>
                  <textarea name="message" id="message" placeholder="Your Message"></textarea>
                </fieldset>
              </div>
              <div class="col-lg-12">
                <fieldset>
                  <button type="submit" id="form-submit" class="orange-button">Send Message</button>
                </fieldset>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <footer>
    <div class="container">
      <div class="col-lg-8">
      </div>
    </div>
  </footer>

  <!-- Scripts -->
  <!-- Bootstrap core JavaScript -->
  <script src="vendor/jquery/jquery.min.js"></script>
  <script src="vendor/bootstrap/js/bootstrap.min.js"></script>
  <script src="assets/js/isotope.min.js"></script>
  <script src="assets/js/owl-carousel.js"></script>
  <script src="assets/js/counter.js"></script>
  <script src="assets/js/custom.js"></script>
  <script src="assets/js/property-data.js"></script>
  <script>
    // Render properties from property-data.js (only first 6 for homepage)
    document.addEventListener('DOMContentLoaded', function() {
      const propertiesContainer = document.querySelector('.properties .container .row');
      const properties = window.propertyData.getAllProperties().slice(0, 6);
      
      // Clear existing properties
      propertiesContainer.innerHTML = '';
      
      // Render each property
      properties.forEach(property => {
        const propertyHTML = `
          <div class="col-lg-4 col-md-6">
            <div class="item" data-property-id="${property.id}">
              <a href="property-details.html?${buildPropertyURL(property)}"><img src="assets/images/${property.image}" alt=""></a>
              <span class="category">${property.category}</span>
              <h6>${property.price}</h6>
              <h4><a href="property-details.html?${buildPropertyURL(property)}">${property.name}</a></h4>
              <ul>
                <li>Bedrooms: <span>${property.bedrooms}</span></li>
                <li>Bathrooms: <span>${property.bathrooms}</span></li>
                <li>Area: <span>${property.area}</span></li>
                <li>Floor: <span>${property.floor}</span></li>
                <li>Parking: <span>${property.parking}</span></li>
              </ul>
              <div class="main-button">
                <a href="#" class="schedule-link" data-property-id="${property.id}" data-property-name="${property.name}">Schedule a visit</a>
              </div>
            </div>
          </div>
        `;
        propertiesContainer.innerHTML += propertyHTML;
      });
    });
    
    // Helper function to build URL parameters
    function buildPropertyURL(property) {
      const params = new URLSearchParams({
        name: property.name,
        category: property.category,
        price: property.price,
        bedrooms: property.bedrooms,
        bathrooms: property.bathrooms,
        area: property.area,
        floor: property.floor,
        parking: property.parking,
        image: property.image
      });
      return params.toString();
    }

    (function () {
      const API_BASE = 'http://localhost:5000/api';

      const feedbackModalEl = document.getElementById('authFeedbackModal');
      const feedbackModal = feedbackModalEl ? new bootstrap.Modal(feedbackModalEl) : null;

      const logoutConfirmModalEl = document.getElementById('logoutConfirmModal');
      const logoutConfirmModal = logoutConfirmModalEl ? new bootstrap.Modal(logoutConfirmModalEl) : null;
      const logoutYesBtn = document.getElementById('logout-confirm-yes');
      const logoutNoBtn = document.getElementById('logout-confirm-no');
      let logoutConfirmResolver = null;

      function askLogoutConfirm() {
        return new Promise((resolve) => {
          if (!logoutConfirmModal) {
            resolve(confirm('Are you sure you want to log out?'));
            return;
          }
          logoutConfirmResolver = resolve;
          logoutConfirmModal.show();
        });
      }

      if (logoutYesBtn) {
        logoutYesBtn.addEventListener('click', () => {
          if (logoutConfirmModal) logoutConfirmModal.hide();
          if (logoutConfirmResolver) logoutConfirmResolver(true);
          logoutConfirmResolver = null;
        });
      }

      if (logoutNoBtn) {
        logoutNoBtn.addEventListener('click', () => {
          if (logoutConfirmModal) logoutConfirmModal.hide();
          if (logoutConfirmResolver) logoutConfirmResolver(false);
          logoutConfirmResolver = null;
        });
      }

      function showAuthFeedback(title, message) {
        if (!feedbackModal) {
          alert(message || title || 'Notification');
          return;
        }
        document.getElementById('auth-feedback-title').textContent = title || 'Notice';
        document.getElementById('auth-feedback-body').textContent = message || '';
        feedbackModal.show();
      }

      function getToken() {
        return localStorage.getItem('nestfinder_jwt') || '';
      }

      function setToken(token) {
        if (token) {
          localStorage.setItem('nestfinder_jwt', token);
        }
      }

      function clearToken() {
        localStorage.removeItem('nestfinder_jwt');
      }

      function openAuthModal(mode) {
        const isLogin = mode === 'login';
        $('#authModalTitle').text(isLogin ? 'Login' : 'Create an account');
        $('#auth-name-group').toggle(!isLogin);
        $('#auth-submit-btn').text(isLogin ? 'Login' : 'Register');
        $('#auth-error').hide();
        $('#auth-form')[0].reset();
        const html = isLogin
          ? "Don't have an account? <a href='#' id='auth-toggle-link'>Register</a>"
          : "Already have an account? <a href='#' id='auth-toggle-link'>Login</a>";
        $('#auth-toggle-text').html(html);
        $('#authModal').modal('show');
        $('#authModal').data('mode', mode);
      }

      function updateAuthNav() {
        const isLoggedIn = !!getToken();
        $('#nav-login-item, #nav-register-item').toggle(!isLoggedIn);
        $('#nav-logout-item').toggle(isLoggedIn);
      }

      function openScheduleModal(propertyId, propertyName) {
        const token = getToken();
        if (!token) {
          openAuthModal('login');
          return;
        }
        $('#schedule-form')[0].reset();
        $('#schedule-property-name').val(propertyName || 'Selected property');
        $('#scheduleModal').data('property-id', propertyId);
        $('#schedule-error').hide();
        $('#schedule-success').hide();
        $('#scheduleModal').modal('show');
      }

      $('#nav-login-link').on('click', function (e) {
        e.preventDefault();
        openAuthModal('login');
      });

      $('#nav-register-link').on('click', function (e) {
        e.preventDefault();
        openAuthModal('register');
      });

      $('#nav-logout-link').on('click', function (e) {
        e.preventDefault();
        askLogoutConfirm().then((ok) => {
          if (!ok) return;
          clearToken();
          updateAuthNav();
          showAuthFeedback('Logged out', 'You have been logged out successfully.');
        });
      });

      $('#nav-schedule-link').on('click', function (e) {
        e.preventDefault();
        const firstProperty = $('.schedule-link').first();
        if (firstProperty.length) {
          openScheduleModal(firstProperty.data('property-id'), firstProperty.data('property-name'));
        } else {
          openScheduleModal('', '');
        }
      });

      $(document).on('click', '.schedule-link', function (e) {
        e.preventDefault();
        const propertyId = $(this).data('property-id');
        const propertyName = $(this).data('property-name');
        openScheduleModal(propertyId, propertyName);
      });

      $(document).on('click', '#auth-toggle-link', function (e) {
        e.preventDefault();
        const currentMode = $('#authModal').data('mode') || 'login';
        openAuthModal(currentMode === 'login' ? 'register' : 'login');
      });

      $('#auth-form').on('submit', function (e) {
        e.preventDefault();
        const mode = $('#authModal').data('mode') || 'login';
        const name = $('#auth-name').val();
        const email = $('#auth-email').val();
        const password = $('#auth-password').val();
        const endpoint = mode === 'login' ? '/auth/login' : '/auth/register';

        $('#auth-error').hide();

        $.ajax({
          url: API_BASE + endpoint,
          method: 'POST',
          contentType: 'application/json',
          data: JSON.stringify({ name, email, password }),
          success: function (res) {
            setToken(res.token);
            $('#authModal').modal('hide');
            updateAuthNav();
            const isLogin = mode === 'login';
            showAuthFeedback(
              isLogin ? 'Login successful' : 'Registration successful',
              isLogin ? 'You are now logged in.' : 'Your account is ready. You are now logged in.'
            );
          },
          error: function (xhr) {
            const message =
              (xhr.responseJSON && xhr.responseJSON.message) ||
              xhr.statusText ||
              'Authentication failed';
            console.error('Auth error', { status: xhr.status, response: xhr.responseText });
            $('#auth-error').text(message).show();
          },
        });
      });

      $('#schedule-form').on('submit', function (e) {
        e.preventDefault();
        const token = getToken();
        if (!token) {
          $('#schedule-error').text('You must be logged in to schedule a visit.').show();
          return;
        }

        const propertyId = $('#scheduleModal').data('property-id') || 'custom';
        const propertyName = $('#schedule-property-name').val() || 'Custom property';
        const visitDate = $('#schedule-date').val();
        const notes = $('#schedule-notes').val();

        // Validate future datetime
        if (!visitDate || Number.isNaN(new Date(visitDate).getTime())) {
          $('#schedule-error').text('Please choose a valid date and time.').show();
          return;
        }
        if (new Date(visitDate).getTime() <= Date.now()) {
          $('#schedule-error').text('Please pick a future date/time for your visit.').show();
          return;
        }

        $('#schedule-error').hide();
        $('#schedule-success').hide();

        $.ajax({
          url: API_BASE + '/visits',
          method: 'POST',
          contentType: 'application/json',
          headers: {
            Authorization: 'Bearer ' + token,
          },
          data: JSON.stringify({ propertyId, propertyName, visitDate, notes }),
          success: function () {
            $('#schedule-success').text('Your visit has been scheduled!').show();
            $('#schedule-form')[0].reset();
          },
          error: function (xhr) {
            const message = (xhr.responseJSON && xhr.responseJSON.message) || 'Could not schedule visit';
            $('#schedule-error').text(message).show();
          },
        });
      });

      updateAuthNav();
    })();
  </script>

  <script>
  
    document.addEventListener('DOMContentLoaded', function() {
      if (!window.propertyData) return;

      function buildPropertyURL(property) {
        const params = new URLSearchParams({
          name: property.name,
          category: property.category,
          price: property.price,
          bedrooms: property.bedrooms,
          bathrooms: property.bathrooms,
          area: property.area,
          floor: property.floor,
          parking: property.parking,
          image: property.image,
          description: property.description
        });
        return 'property-details.html?' + params.toString();
      }

      function truncateText(text, maxLength) {
        const stripped = text.replace(/<[^>]*>/g, '');
        if (stripped.length <= maxLength) return stripped;
        return stripped.substring(0, maxLength) + '...';
      }

      // Get most recent property from each category
      const apartments = window.propertyData.properties.filter(p => p.categoryClass === 'apt');
      const houses = window.propertyData.properties.filter(p => p.categoryClass === 'hou');
      const villaHouses = window.propertyData.properties.filter(p => p.categoryClass === 'vhs');

      // Get the last (most recent) property from each category
      const latestApartment = apartments[apartments.length - 1];
      const latestHouse = houses[houses.length - 1];
      const latestVillaHouse = villaHouses[villaHouses.length - 1];

      // Update Apartment tab
      if (latestApartment) {
        document.getElementById('apartment-info').innerHTML = `
          <li>Total Flat Space <span>${latestApartment.area}</span></li>
          <li>Floor number <span>${latestApartment.floor}</span></li>
          <li>Number of Bedrooms <span>${latestApartment.bedrooms}</span></li>
          <li>Parking Available <span>${latestApartment.parking}</span></li>
          <li>Price<span>${latestApartment.price}</span></li>
        `;
        document.getElementById('apartment-image').src = 'assets/images/' + latestApartment.image;
        document.getElementById('apartment-description').innerHTML = truncateText(latestApartment.description, 250);
        document.getElementById('apartment-visit-link').href = buildPropertyURL(latestApartment);
      }

      // Update House tab
      if (latestHouse) {
        document.getElementById('house-info').innerHTML = `
          <li>Total Flat Space <span>${latestHouse.area}</span></li>
          <li>Floor number <span>${latestHouse.floor}</span></li>
          <li>Number of Bedrooms <span>${latestHouse.bedrooms}</span></li>
          <li>Parking Available <span>${latestHouse.parking}</span></li>
          <li>Price<span>${latestHouse.price}</span></li>
        `;
        document.getElementById('house-image').src = 'assets/images/' + latestHouse.image;
        document.getElementById('house-description').innerHTML = truncateText(latestHouse.description, 250);
        document.getElementById('house-visit-link').href = buildPropertyURL(latestHouse);
      }

      if (latestVillaHouse) {
        document.getElementById('villahouse-info').innerHTML = `
          <li>Total Flat Space <span>${latestVillaHouse.area}</span></li>
          <li>Floor number <span>${latestVillaHouse.floor}</span></li>
          <li>Number of Bedrooms <span>${latestVillaHouse.bedrooms}</span></li>
          <li>Parking Available <span>${latestVillaHouse.parking}</span></li>
          <li>Price<span>${latestVillaHouse.price}</span></li>
        `;
        document.getElementById('villahouse-image').src = 'assets/images/' + latestVillaHouse.image;
        document.getElementById('villahouse-description').innerHTML = truncateText(latestVillaHouse.description, 250);
        document.getElementById('villahouse-visit-link').href = buildPropertyURL(latestVillaHouse);
      }
    });
  </script>

  </body>
</html>